# Docker Script

このリポジトリには、Dockerコンテナを利用して研究開発環境を手軽にセットアップするためのスクリプト `run.sh` が含まれています。スクリプトを使って、コンテナの起動、Jupyter Notebookの起動、カレントディレクトリのマウントなどを簡単に行うことができます。

## ファイル一覧

- **`run.sh`**: Dockerコンテナを起動し、必要なオプションで設定します。
- **`exec.sh`**: 起動中のコンテナに接続するためのスクリプト。（このファイルの説明は省略していますが、コンテナにアクセスするための補助ツールとして利用できます）
- **`status.sh`**: コンテナの状態を確認・再起動するためのスクリプト。
- **`stop.sh`**: コンテナを停止・削除するスクリプト。

## `run.sh` の使い方

このスクリプトは、新しいDockerコンテナを起動するか、既存のコンテナが存在する場合は削除してから新しいコンテナを作成するスクリプトです。特に研究開発環境を想定して設計されています。

### スクリプトの実行方法

```sh
./run.sh [オプション]
```

### オプション一覧

- **`-i IMAGE_NAME`**: 使用するDockerイメージの名前を指定します。デフォルトは `"yaelvinker/clipasso_docker_updated"` です。
- **`-n CONTAINER_NAME`**: 起動するコンテナの名前を指定します。デフォルトは `"clipsketch_container"` です。
- **`-p HOST_PORT`**: ホストの公開ポートを指定します。デフォルトは `8888` です。このポートはJupyter Notebookのアクセスに使用されます。
- **`-j`**: Jupyter Notebookを起動する場合に指定します。このフラグを指定すると、コンテナ内でJupyter Notebookが起動します。

### 例

1. **基本的なコンテナの起動**（デフォルト設定）:

   ```sh
   ./run.sh
   ```

   - コンテナ `clipsketch_container` がバックグラウンドで起動し、カレントディレクトリを `/workspace` としてマウントします。
   - `tail -f /dev/null` を実行することで、コンテナが停止せずに維持されます。

2. **Jupyter Notebook を起動する**:

   ```sh
   ./run.sh -j
   ```

   - コンテナ内でJupyter Notebookが起動し、`http://localhost:8888` でアクセスできます。

3. **コンテナ名とポートを指定する**:

   ```sh
   ./run.sh -n my_container -p 9999
   ```

   - `my_container` という名前のコンテナを起動し、ホストの `9999` ポートで公開します。

### スクリプトの仕組み

1. **既存のコンテナが存在するかの確認と削除**:
   - コンテナが既に存在する場合、削除を行います。このため、古いコンテナを残さずに環境を常に新しく保つことができます。

2. **Jupyter Notebookの起動**:
   - `-j` フラグを付けると、Jupyter Notebookがコンテナ内で起動し、指定されたポートでアクセス可能になります。
   
3. **バックグラウンドでのコンテナ保持**:
   - Jupyter Notebookが起動していない場合、`tail -f /dev/null` コマンドを使用してコンテナをバックグラウンドで保持します。これにより、コンテナ内に何も実行していなくても環境が維持されます。

### 注意事項

- **コンテナの削除について**:
  - スクリプトは、既存の同じ名前のコンテナが存在する場合、自動的に削除して新しいコンテナを起動します。そのため、データが保存されていない場合は削除される可能性がありますのでご注意ください。

- **カレントディレクトリのマウント**:
  - スクリプトは、現在の作業ディレクトリを `/workspace` としてコンテナにマウントします。これにより、ホスト上での作業がコンテナ内に反映され、開発効率を向上させます。

- **GPU利用**:
  - `--gpus all` オプションを付けることで、全てのGPUがコンテナ内で使用可能になります。GPUを利用した研究開発に適しています。

## その他のスクリプトについて

- **`exec.sh`**:
  - 既存のコンテナにシェル接続するためのスクリプトです。
  - 実行方法: `./exec.sh -n コンテナ名`

- **`status.sh`**:
  - コンテナの状態を確認し、必要であれば再起動するためのスクリプトです。
  - 実行方法: `./status.sh -n コンテナ名`

- **`stop.sh`**:
  - 不要になったコンテナを停止し削除するためのスクリプトです。
  - 実行方法: `./stop.sh -n コンテナ名`

